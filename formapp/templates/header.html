<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{% block title %}{% endblock %}</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
      <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
      {% block style %}{% endblock %}
  </head>

  <body class="{% block color %}{% endblock %}">
    {% block main %}{% endblock %}
  </body>

  <script>
    let request = new XMLHttpRequest();
    request.open("GET", '/getip', false);
    request.send(null);
    let serverIp = JSON.parse(request.responseText).ip;
    let ws = new WebSocket(`ws://${serverIp}:9001`);

    function getResponse(endpoint, parse = true) {
      return new Promise((resolve, reject) => {
        let newRequest = new XMLHttpRequest();
        newRequest.open("GET", endpoint);
        newRequest.onload = () => {
          parse ? resolve(JSON.parse(newRequest.responseText)) : resolve(newRequest.responseText);
        };
        newRequest.send(null);
      });
    }

    let urlParams = new URLSearchParams(window.location.search);

    //If URL param "message" is present, display as alert
    if (urlParams.get("alert")) {
      alert(urlParams.get("alert"));
      ////To do: only remove alert, keep other params
      window.location = window.location.pathname; //Remove message so it doesn't appear again if page is reloaded
    }

    //If the user is on a mobile device, take them to /mobile
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) && window.location.pathname != "/mobile" && !(window.location.pathname == "/login" && urlParams.get("forward") == "/mobile")) window.location = "/mobile";
  </script>
  {% block script %}{% endblock %}
</html>
