<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{% block title %}{% endblock %}</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
      <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
      {% block style %}{% endblock %}
      <style>
        #homeLink {
          position: absolute;
          left: 8px;
          top: 8px;
          color: var(--light-red);
          font-size: 20px;
          font-weight: bold;
          text-decoration: none;
        }

        .light #homeLink {
          color: var(--color-red);
        }

        #homeLink:hover {
          color: var(--main-color);
        }
      </style>
  </head>

  <body class="{% block color %}{% endblock %}">
    {% block main %}{% endblock %}
  </body>

  <script src="{{url_for('static', filename='js/jquery.js')}}"></script>
  <script src="{{url_for('static', filename='js/socket.io.min.js')}}"></script>
  <script>
    const request = new XMLHttpRequest();
    request.open("GET", '/api/ip', false);
    request.send(null);
    const serverIp = JSON.parse(request.responseText).ip;
    const ws = new WebSocket(`ws://${serverIp}:9001`);

    const apiSocket = io("/apinamespace");
    const chatSocket = io("/chat");

    function getResponse(endpoint, parse = true) {
      return new Promise((resolve, reject) => {
        let newRequest = new XMLHttpRequest();
        endpoint += (endpoint.includes("?") ? "&" : "?");
        endpoint += "return=json";
        newRequest.open("GET", endpoint);
        newRequest.onload = () => {
          if (parse) {
            try {
              resolve(JSON.parse(newRequest.responseText));
            } catch {
              resolve({});
            }
          } else {
            resolve(newRequest.responseText);
          }
        };
        newRequest.send(null);
      });
    }

    const urlParams = new URLSearchParams(window.location.search);

    //If the user is on a mobile device, take them to /mobile
    if (
      /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) &&
      window.location.pathname != "/mobile" &&
      !(window.location.pathname == "/login" && urlParams.get("forward") == "/mobile") &&
      !(window.location.pathname == "/chat" && urlParams.get("mobile"))
    ) window.location = "/mobile";
  </script>
  {% block script %}{% endblock %}
</html>
